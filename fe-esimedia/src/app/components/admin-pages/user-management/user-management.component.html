<div class="user-management-container">
  <h1>User Management</h1>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <p>Cargando usuarios...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="errorMessage && !isLoading">
    <p>{{ errorMessage }}</p>
    <button (click)="loadUsers()">Reintentar</button>
  </div>

  <!-- Search & Filters -->
  <div class="search-filters-section" *ngIf="!isLoading && !errorMessage">
    <!-- Search Bar Meter-->
    <input 
      type="text" class="search-input" placeholder="Buscar por nombre, correo o alias"
      [(ngModel)]="searchTerm" (input)="onSearch()" (keyup.enter)="onSearch()"> 

    <!-- Dropdowns -->
    <div class="filters-row">
      <select class="filter-dropdown" [(ngModel)]="selectedRole" (change)="onFilterChange()">
        <option value="">All Roles</option>
        <option value="ADMIN">Admin</option>
        <option value="CREADOR">Creador</option>
        <option value="USUARIO">Usuario</option>
      </select>

      <select class="filter-dropdown" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
        <option value="">All Status</option>
        <option value="bloqueado">Bloqueado</option>
        <option value="desbloqueado">Desbloqueado</option>
      </select>

      <select class="filter-dropdown" [(ngModel)]="selectedVipFilter" (change)="onFilterChange()">
        <option value="">VIP Filter</option>
        <option value="vip">VIP</option>
        <option value="novip">No VIP</option>
      </select>
    </div>

  <!-- Users List -->
  <div class="users-list" *ngIf="!isLoading && !errorMessage">
    <div class="user-card" *ngFor="let user of filteredUsers" >
      <!-- Left Side: User Info -->
      <div class="user-info">
        <img [src]="getAvatar(user)" alt="User Avatar" class="user-avatar">
        <div class="user-details">
          <h3 class="user-name">{{ user.name }}</h3>
          <p class="user-email">{{ user.email }}</p>
          <div class="user-meta">
            <span class="alias">{{ user.alias }}</span>
            <span class="role-badge" [ngClass]="'role-' + user.role">{{ user.role | uppercase }}</span>
          </div>
        </div>
      </div>

      <!-- Right Side: Status and Actions -->
      <div class="user-actions">
        <div class="status-badges">
          <span class="badge blocked" *ngIf="user.blocked">BLOQUEADO</span>
          <span class="badge vip" *ngIf="user.vip">VIP</span>
        </div>
        <div class="action-icons">
          <button 
            class="icon-btn block" 
            [class.unblock]="user.blocked"
            [title]="user.blocked ? 'Desbloquear Usuario' : 'Bloquear Usuario'" 
            (click)="toggleBlockUser(user.email)">
            <mat-icon>{{ user.blocked ? 'lock_open' : 'block' }}</mat-icon>
          </button>
          <button class="icon-btn edit" title="Edit User" (click)="editUser(user.email)">
            <mat-icon>edit</mat-icon>
          </button>
          <button class="icon-btn delete" title="Delete User" (click)="deleteUser(user.email)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredUsers.length === 0">
      <p>No users found matching your filters.</p>
    </div>
  </div>
</div>