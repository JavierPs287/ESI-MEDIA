<app-navbar></app-navbar>
<body class="background">
<div class="register-container">
  <h1 class="form-title">Nueva Contraseña</h1>
  <p class="form-subtitle">Defina su nueva contraseña.</p>

  <!-- Mostrar mensaje de carga mientras valida el token -->
  <div *ngIf="isValidatingToken" class="message-container">
    <p>Validando token...</p>
  </div>

  <!-- Mostrar error si el token no es válido -->
  <div *ngIf="!isValidatingToken && !tokenValid" class="message-container">
    <div class="error-message">{{ registrationResponse?.error }}</div>
    <p>Será redirigido a la página principal...</p>
  </div>

  <!-- Mostrar formulario solo si el token es válido -->
  <form *ngIf="!isValidatingToken && tokenValid" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
  <div class="form-field">
    <label for="contrasena">Contraseña *</label>
      <div class="password-field">
      <input [type]="!visiblePassword?'password':'text'" placeholder="Contraseña" formControlName="contrasena">
      <button 
        class="eyeicon" 
        (click)="togglePasswordVisibility()">
        <i [ngClass]="visiblePassword?'fa fa-eye':'fa fa-eye-slash'"></i>
      </button>
    </div>
    <div class="error-container" *ngIf="getControl('contrasena')?.invalid && (getControl('contrasena')?.touched || getControl('contrasena')?.dirty)">
      <p class ="error-message" *ngIf="getControl('contrasena')?.hasError('required')"> El campo es obligatorio. </p>
      <p class ="error-message" *ngIf="getControl('contrasena')?.hasError('minlength')"> Mínimo 8 caracteres. </p>
      <p class ="error-message" *ngIf="getControl('contrasena')?.hasError('maxlength')"> Máximo 128 caracteres. </p>
      <p class ="error-message" *ngIf="getControl('contrasena')?.hasError('noLowercase')">❌ Debe contener al menos una letra minúscula</p>
      <p class ="error-message" *ngIf="getControl('contrasena')?.hasError('noUppercase')">❌ Debe contener al menos una letra mayúscula</p>
      <p class ="error-message" *ngIf="getControl('contrasena')?.hasError('noNumber')">❌ Debe contener al menos un número</p>
      <p class ="error-message" *ngIf="getControl('contrasena')?.hasError('noSpecialChar')">❌ Debe contener al menos un carácter especial</p>
      </div>
  </div>

    <div class="form-field">
      <label for="repetirContrasena">Repetir Contraseña *</label>
      <input id="repetirContrasena" type="password" placeholder="Repetir contraseña" formControlName="repetirContrasena">
      <div class="error-container" *ngIf="(getControl('repetirContrasena')?.invalid && (getControl('repetirContrasena')?.touched || getControl('repetirContrasena')?.dirty)) || (registerForm.errors?.['passwordMismatch'] && (getControl('repetirContrasena')?.touched || getControl('repetirContrasena')?.dirty))">
        <p class="error-message" *ngIf="getControl('repetirContrasena')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="registerForm.errors?.['passwordMismatch'] && (getControl('repetirContrasena')?.touched || getControl('repetirContrasena')?.dirty)"> Las contraseñas no coinciden. </p>
      </div>
    </div>

    <div class="message-container">
      <div class="success-message" *ngIf="registrationResponse?.message && !registrationResponse?.error">{{ registrationResponse?.message }}</div>
      <div class="error-message" *ngIf="registrationResponse?.error">{{ registrationResponse?.error }}</div>
    </div>

    <div class="actions">
      <button type="submit" class="create-btn" [disabled]="!registerForm.valid">Cambiar contraseña</button>
    </div>

  </form>
</div>
</body>
