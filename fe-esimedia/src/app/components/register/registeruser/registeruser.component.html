    <div class="form-field">
      <p for="3fa" class="form-subtitle">Activa la verificación en tres pasos para máxima seguridad.</p>
        <div class="btn-container">
        <button
          type="button" class="btn-3fa" (click)="toggle3FA()"
          [ngClass]="{'fa3-active': is3FAEnabled, 'fa3-inactive': !is3FAEnabled}"
          [disabled]="!is2FAEnabled">
          {{ is3FAEnabled ? '3FA Activado' : '3FA Desactivado' }}
        </button>
      </div>
    </div>
<app-navbar></app-navbar>
<body class="background">
<div class="register-container">
  <h1 class="form-title">Join ESI-Media</h1>
  <p class="form-subtitle">El mejor audio y vídeo con la mejor calidad y contenido exclusivo.</p>

  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

    <div class="form-field">
      <label for="name">Nombre *</label>
      <input id="name" type="text" placeholder="Nombre" formControlName="name">
      <div class="error-container" *ngIf="getControl('name')?.invalid && (getControl('name')?.touched || getControl('name')?.dirty)">
        <p class="error-message" *ngIf="getControl('name')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="getControl('name')?.hasError('maxlength')"> Máximo 50 caracteres. </p>
      </div>
    </div>

    <div class="form-field">
      <label for="lastName">Apellidos *</label>
      <input id="lastName" type="text" placeholder="Apellidos" formControlName="lastName">
      <div class="error-container" *ngIf="getControl('lastName')?.invalid && (getControl('lastName')?.touched || getControl('lastName')?.dirty)">
        <p class="error-message" *ngIf="getControl('lastName')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="getControl('lastName')?.hasError('maxlength')"> Máximo 100 caracteres. </p>
      </div>
    </div>

    <div class="form-field">
      <label for="email">Email *</label>
      <input id="email" type="email" placeholder="Dirección de correo" formControlName="email">
      <div class="error-container" *ngIf="getControl('email')?.invalid && (getControl('email')?.touched || getControl('email')?.dirty)">
        <p class="error-message" *ngIf="getControl('email')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="getControl('email')?.hasError('email')"> Formato de email inválido. </p>
        <p class="error-message" *ngIf="getControl('email')?.hasError('minAge')"> Debes tener al menos 4 años para registrarte. </p>
      </div>
    </div>

    <div class="form-field">
      <label for="alias">Alias</label>
      <input id="alias" type="text" placeholder="Alias" formControlName="alias">
    </div>

    <div class="form-field">
      <label for="birthDate">Fecha de nacimiento *</label>
      <input id="birthDate" type="date" placeholder="DD/MM/AAAA" formControlName="birthDate">
      <div class="error-container" *ngIf="getControl('birthDate')?.invalid && (getControl('birthDate')?.touched || getControl('birthDate')?.dirty)">
        <p class="error-message" *ngIf="getControl('birthDate')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="getControl('birthDate')?.hasError('minAge')"> Debes tener al menos 4 años para registrarte. </p>
      </div>
    </div>

    <div class="form-field">
      <label for="foto">Foto de perfil </label>
      <button type="button" class="photo-selector-btn" (click)="togglePhotoOptions()">
        {{ selectedPhoto ? 'Cambiar foto' : 'Seleccionar foto' }}
      </button>

      <div class="photo-options" *ngIf="showPhotoOptions">
        <div class="photo-grid">
          <img *ngFor="let avatar of avatarOptions.slice(1)" 
               [src]="avatar.url" 
               [alt]="avatar.id"
               class="photo-option"
               [class.selected]="selectedPhoto === avatar.id"
               (click)="selectPhoto(avatar.id)"
               (keydown.enter)="selectPhoto(avatar.id)">
        </div>
      <a class="link" href="http://www.freepik.com">Designed by studiogstock / Freepik</a>
      </div>
    </div>

    <div class="form-field">
      <p for="vip" class="form-subtitle">Hazte VIP y disfruta de contenido exclusivo y beneficios adicionales.</p>
        <div class="btn-container">
        <button
          type="button" class="btn-vip" (click)="toggleVip()"
          [ngClass]="{'vip-active': isVip, 'vip-inactive': !isVip}">
          {{ isVip ? 'VIP' : 'No eres VIP' }}
        </button>
      </div>
    </div>

    <div class="form-field">
      <p for="2fa" class="form-subtitle">Activa la verificación en dos pasos para mayor seguridad.</p>
        <div class="btn-container">
        <button
          type="button" class="btn-2fa" (click)="toggle2FA()"
          [ngClass]="{'fa2-active': is2FAEnabled, 'fa2-inactive': !is2FAEnabled}">
          {{ is2FAEnabled ? '2FA Activado' : '2FA Desactivado' }}
        </button>
      </div>
    </div>

  <div class="form-field">
    <label for="password">Contraseña *</label>
      <div class="password-field">
      <input [type]="!visiblePassword?'password':'text'" placeholder="Contraseña" formControlName="password">
      <button type="button" class="eyeicon" (click)="togglePasswordVisibility()">
        <mat-icon *ngIf="visiblePassword">visibility</mat-icon>
        <mat-icon *ngIf="!visiblePassword">visibility_off</mat-icon>
      </button>
    </div>
    <div class="error-container" *ngIf="getControl('password')?.invalid && (getControl('password')?.touched || getControl('password')?.dirty)">
      <p class ="error-message" *ngIf="getControl('password')?.hasError('required')"> El campo es obligatorio. </p>
      <p class ="error-message" *ngIf="getControl('password')?.hasError('minlength')"> Mínimo 8 caracteres. </p>
      <p class ="error-message" *ngIf="getControl('password')?.hasError('maxlength')"> Máximo 128 caracteres. </p>
      <p class ="error-message" *ngIf="getControl('password')?.hasError('noLowercase')">❌ Debe contener al menos una letra minúscula</p>
      <p class ="error-message" *ngIf="getControl('password')?.hasError('noUppercase')">❌ Debe contener al menos una letra mayúscula</p>
      <p class ="error-message" *ngIf="getControl('password')?.hasError('noNumber')">❌ Debe contener al menos un número</p>
      <p class ="error-message" *ngIf="getControl('password')?.hasError('noSpecialChar')">❌ Debe contener al menos un carácter especial</p>
      </div>
  </div>

    <div class="form-field">
      <label for="repetePassword">Repetir Contraseña *</label>
      <div class="password-field">
      <input [type]="!visibleRepetePassword?'password':'text'" placeholder="Repetir contraseña" formControlName="repetePassword">
      <button type="button" class="eyeicon" (click)="toggleRepetePasswordVisibility()">
        <mat-icon *ngIf="visibleRepetePassword">visibility</mat-icon>
        <mat-icon *ngIf="!visibleRepetePassword">visibility_off</mat-icon>
      </button>
    </div>
      <div class="error-container" *ngIf="(getControl('repetePassword')?.invalid && (getControl('repetePassword')?.touched || getControl('repetePassword')?.dirty)) || (registerForm.errors?.['passwordMismatch'] && (getControl('repetePassword')?.touched || getControl('repetePassword')?.dirty))">
        <p class="error-message" *ngIf="getControl('repetePassword')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="registerForm.errors?.['passwordMismatch'] && (getControl('repetePassword')?.touched || getControl('repetePassword')?.dirty)"> Las contraseñas no coinciden. </p>
      </div>
    </div>

    <div class="message-container">
      <div class="success-message" *ngIf="registrationResponse?.message && !registrationResponse?.error">{{ registrationResponse?.message }}</div>
      <div class="error-message" *ngIf="registrationResponse?.error">{{ registrationResponse?.error }}</div>
    </div>

    <div class="actions">
      <button type="submit" class="create-btn" 
      [disabled]="!registerForm.valid || isSubmitting">Crear cuenta</button>
    </div>

  </form>

  <hr class="divider">
  <div class="log-in">
    <p class="info-link">¿Ya tienes una cuenta? <a class="link" href="/login">Iniciar sesión</a></p>
  </div>
</div>
</body>