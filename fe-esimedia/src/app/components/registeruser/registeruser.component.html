<app-navbar></app-navbar>
<body class="background">
<div class="register-container">
  <h1 class="form-title">Join ESI-Media</h1>
  <p class="form-subtitle">El mejor audio y vídeo con la mejor calidad y contenido exclusivo.</p>

  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

    <div class="form-field">
      <label for="nombre">Nombre *</label>
      <input id="nombre" type="text" placeholder="Nombre" formControlName="nombre">
      <div class="error-container" *ngIf="getControl('nombre')?.invalid && (getControl('nombre')?.touched || getControl('nombre')?.dirty)">
        <p class="error-message" *ngIf="getControl('nombre')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="getControl('nombre')?.hasError('maxlength')"> Máximo 25 caracteres. </p>
      </div>
    </div>

    <div class="form-field">
      <label for="apellidos">Apellidos *</label>
      <input id="apellidos" type="text" placeholder="Apellidos" formControlName="apellidos">
      <div class="error-container" *ngIf="getControl('apellidos')?.invalid && (getControl('apellidos')?.touched || getControl('apellidos')?.dirty)">
        <p class="error-message" *ngIf="getControl('apellidos')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="getControl('apellidos')?.hasError('maxlength')"> Máximo 25 caracteres. </p>
      </div>
    </div>

    <div class="form-field">
      <label for="email">Email *</label>
      <input id="email" type="email" placeholder="Dirección de correo" formControlName="email">
      <div class="error-container" *ngIf="getControl('email')?.invalid && (getControl('email')?.touched || getControl('email')?.dirty)">
        <p class="error-message" *ngIf="getControl('email')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="getControl('email')?.hasError('email')"> Formato de email inválido. </p>
      </div>
    </div>

    <div class="form-field">
      <label for="alias">Alias</label>
      <input id="alias" type="text" placeholder="Alias" formControlName="alias">
    </div>

    <div class="form-field">
      <label for="fecha_nacimiento">Fecha de nacimiento *</label>
      <input id="fecha_nacimiento" type="date" formControlName="fecha_nacimiento">
      <div class="error-container" *ngIf="getControl('fecha_nacimiento')?.invalid && (getControl('fecha_nacimiento')?.touched || getControl('fecha_nacimiento')?.dirty)">
        <p class="error-message" *ngIf="getControl('fecha_nacimiento')?.hasError('required')"> El campo es obligatorio. </p>
      </div>
    </div>

    <div class="form-field">
      <label for="foto_perfil">Foto de perfil</label>
      <button type="button" class="photo-selector-btn" (click)="togglePhotoOptions()">
        {{ selectedPhoto ? 'Cambiar foto' : 'Seleccionar foto' }}
      </button>
      <div class="photo-options" *ngIf="showPhotoOptions">
        <div class="photo-grid">
          <button *ngFor="let avatar of avatarOptions" type="button" class="photo-option-button" [class.selected]="selectedPhoto === avatar.imagePath" (click)="selectPhoto(avatar.imagePath)">
            <img [src]="avatar.imagePath" [alt]="avatar.displayName" class="photo-option">
          </button>
        </div>
      </div>
    </div>

    <div class="form-field">
      <p for="vip" class="form-subtitle">Hazte VIP y disfruta de contenido exclusivo y beneficios adicionales.</p>
        <div class="btn-container">
        <button
          class="btn-vip"
          (click)="toggleVip()"
          [ngClass]="{'vip-active': isVip, 'vip-inactive': !isVip}">
          {{ isVip ? 'VIP' : 'No eres VIP' }}
        </button>
      </div>
    </div>

    <div class="form-field">
      <label for="contrasena">Contraseña *</label>
      <div class="password-field">
        <input id="contrasena" [type]="visiblePassword ? 'text' : 'password'" placeholder="Contraseña" formControlName="contrasena">
        <button type="button" class="toggle-password" (click)="togglePasswordVisibility()" aria-label="Mostrar u ocultar contraseña">
          <svg *ngIf="!visiblePassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          <svg *ngIf="visiblePassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.69 21.69 0 0 1 5.06-6.06"></path>
            <path d="M1 1l22 22"></path>
          </svg>
        </button>
      </div>
      <div *ngIf="registerForm.get('contrasena')?.invalid && registerForm.get('contrasena')?.touched">
        <span class="error" *ngIf="registerForm.get('contrasena')?.hasError('required')">
          Contraseña es un campo obligatorio</span>
        <span class="error" *ngIf="registerForm.get('contrasena')?.hasError('minlength')">
          La contraseña debe tener al menos 8 caracteres</span>
        <span class="error" *ngIf="registerForm.get('contrasena')?.hasError('maxlength')">
          La contraseña no puede tener más de 20 caracteres</span>
        <span class="error" *ngIf="registerForm.get('contrasena')?.hasError('pattern')">
          La contraseña debe incluir mayúsculas, minúsculas, números y caracteres especiales (&#64;$!%*?&amp;)</span>
      </div>
    </div>

    <div class="form-field">
      <label for="repetirContrasena">Repetir Contraseña *</label>
      <input id="repetirContrasena" type="password" placeholder="Repetir contraseña" formControlName="repetirContrasena">
      <div class="error-container" *ngIf="(getControl('repetirContrasena')?.invalid && (getControl('repetirContrasena')?.touched || getControl('repetirContrasena')?.dirty)) || (registerForm.errors?.['passwordMismatch'] && (getControl('repetirContrasena')?.touched || getControl('repetirContrasena')?.dirty))">
        <p class="error-message" *ngIf="getControl('repetirContrasena')?.hasError('required')"> El campo es obligatorio. </p>
        <p class="error-message" *ngIf="registerForm.errors?.['passwordMismatch'] && (getControl('repetirContrasena')?.touched || getControl('repetirContrasena')?.dirty)"> Las contraseñas no coinciden. </p>
      </div>
    </div>

    <div class="message-container">
      <div class="success-message" *ngIf="registrationResponse?.message && !registrationResponse?.error">{{ registrationResponse?.message }}</div>
      <div class="error-message" *ngIf="registrationResponse?.error">{{ registrationResponse?.error }}</div>
    </div>

    <div class="actions">
      <button type="submit" class="create-btn" [disabled]="!registerForm.valid">Crear cuenta</button>
    </div>

  </form>

  <hr class="divider">
  <div class="log-in">
    <p class="info-link">¿Ya tienes una cuenta? <a class="link" href="/login">Iniciar sesión</a></p>
  </div>
</div>
</body>
